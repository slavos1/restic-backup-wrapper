{% set space=' ' %}
# Generated by {{ cli_info }} on {{utc_now}}
{% for key, backup_info in all_commands.items() %}
# commands for key {{ key|repr }}
{% set prefix %}
{% line %}
{% if backup_info.relative_to %}(cd {{ backup_info.relative_to }} &&{% endif %}
{{ restic_command }}
{% if restic_repo %}-r {{ restic_repo }}{% endif %}
{% endline %}{% endset %}

{% set suffix %}{% if backup_info.relative_to %}){% endif %}{% endset %}

{# main line #}
{{ prefix }}{{space}}{% linex %}
backup {{ backup_info.dir }}

{% if backup_info.dry_run %}--dry-run{% endif %}

{% if backup_info.group_by %}--group-by '{{ backup_info.group_by }}'{% endif %}

{% if backup_info.tags %}--tag '{{ backup_info.tags|sorted|join(',') }}'{% endif %}

{% for i in backup_info.exclude|sorted %}-e '{{i}}'{{space}}{% endfor %}
{% endlinex %}{{ suffix }}

{# possible second line #}
{% if backup_info.keep_last -%}
{{ prefix }}{{space}}{% linex %}
forget --prune --keep-last {{ backup_info.keep_last }} --path {{ backup_info.abs_path }}
{% endlinex %}{{ suffix }}
{% endif %}

{% endfor %}
